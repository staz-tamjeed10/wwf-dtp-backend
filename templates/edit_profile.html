{% extends 'base.html' %}
{% load custom_filters %}
{% block title %}Edit Profile{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root {
        --primary-bg: #192752;
        --secondary-bg: #F8CE9F;
        --accent-color: #723B18;
        --error-color: #ff6b6b;
        --transition-time: 0.3s;
        --text-light: #F8CE9F;
        --input-bg: rgba(248, 206, 159, 0.15);
    }

    .edit-profile-container {
        background-color: var(--secondary-bg);
        min-height: 100vh;
        padding: 2rem 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .profile-card {
        background-color: var(--primary-bg);
        color: var(--text-light);
        border-radius: 1.5rem;
        box-shadow: 0 10px 30px rgba(25, 39, 82, 0.2);
        animation: formEntrance 0.6s ease-out;
        max-width: 800px;
        width: 100%;
        padding: 2rem;
        transition: transform var(--transition-time) ease;
    }

    .profile-card:hover {
        transform: translateY(-5px);
    }

    .form-control, .custom-select {
        background-color: var(--input-bg);
        border: 2px solid var(--secondary-bg);
        color: var(--text-light);
        padding: 1rem 1.5rem;
        border-radius: 0.75rem;
        transition: all var(--transition-time) ease;
        font-size: 0.95rem;
        line-height: 1.6;
        min-height: 56px;
        width: 100%;
        box-sizing: border-box;
    }

    .form-control::placeholder {
        color: rgba(248, 206, 159, 0.6);
        opacity: 1;
    }

    .form-control:focus, .custom-select:focus {
        background-color: rgba(248, 206, 159, 0.25);
        color: var(--text-light);
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(114, 59, 24, 0.25);
        outline: none;
    }

    .custom-select {
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F8CE9F'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1.5rem center;
        background-size: 14px;
        padding-right: 3rem !important;
    }

    .custom-select option {
        background: var(--primary-bg);
        color: var(--text-light);
        padding: 12px 16px;
        font-size: 0.95rem;
    }

    .select-wrapper {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .dropdown-arrow {
        position: absolute;
        right: 1.5rem;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: var(--text-light);
        font-size: 0.9rem;
    }

    .certification-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.2rem;
        margin-top: 0.5rem;
    }

    .cert-label {
        display: flex;
        align-items: center;
        padding: 1.2rem;
        background: var(--input-bg);
        border: 2px solid var(--secondary-bg);
        border-radius: 0.75rem;
        color: var(--text-light);
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 64px;
        box-sizing: border-box;
    }

    .cert-label:hover {
        background: rgba(114, 59, 24, 0.3);
    }

    .certification-option input:checked + .cert-label {
        background: var(--secondary-bg);
        color: var(--primary-bg);
        border-color: var(--accent-color);
    }

    .btn-primary {
        background-color: var(--secondary-bg);
        color: var(--primary-bg);
        border-radius: 0.75rem;
        padding: 1rem 2rem;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        min-width: 250px;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
    }

    .btn-primary:hover {
        background-color: #f5b97a;
        transform: translateY(-2px);
        border-color: var(--accent-color);
        box-shadow: 0 5px 15px rgba(114, 59, 24, 0.3);
    }

    .form-label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
        font-size: 1.05rem;
        color: var(--secondary-bg);
    }

    .alert {
        border-radius: 0.75rem;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
    }

    .invalid-feedback {
        display: block;
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: rgba(255, 107, 107, 0.15);
        border-radius: 0.5rem;
    }

    .required-asterisk {
        color: var(--error-color);
        font-weight: 700;
        margin-left: 3px;
    }

    input:disabled {
        background: rgba(248, 206, 159, 0.08) !important;
        opacity: 0.8;
        cursor: not-allowed;
    }

    #password-requirements {
        color: var(--text-light);
        background: rgba(25, 39, 82, 0.4);
        border-radius: 0.75rem;
        padding: 1.25rem;
    }

    @media (max-width: 768px) {
        .profile-card {
            padding: 1.5rem;
            border-radius: 1rem;
        }
        
        .form-control, .custom-select {
            padding: 0.9rem 1.2rem;
            min-height: 48px;
            font-size: 0.9rem;
        }
        
        .cert-label {
            padding: 1rem;
            min-height: 56px;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            width: 100%;
            min-width: auto;
            padding: 0.9rem 1.5rem;
        }
        
        .form-label {
            font-size: 1rem;
        }
    }

    @keyframes formEntrance {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
<!-- Add this to your existing style block in view_qr_codes.html -->
<style>
    /* Message Styling */
    .alert {
        position: relative;
        padding: 1.25rem 1.25rem 1.25rem 3rem;
        border: none;
        border-radius: 8px;
        margin: 1rem auto;
        max-width: 800px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        font-size: 0.95rem;
        line-height: 1.5;
        display: flex;
        align-items: center;
    }

    .alert:before {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        font-size: 1.5rem;
    }

    .alert-success {
        background-color: rgba(248, 206, 159, 0.9); /* var(--secondary-bg) with opacity */
        color: #723B18; /* var(--accent-color) */
        border-left: 4px solid #723B18;
    }

    .alert-success:before {
        content: "\f058"; /* check-circle icon */
        color: #4CAF50;
    }

    .alert-error, .alert-danger {
        background-color: rgba(255, 107, 107, 0.9); /* var(--error-color) with opacity */
        color: #721c24;
        border-left: 4px solid #721c24;
    }

    .alert-error:before, .alert-danger:before {
        content: "\f06a"; /* exclamation-circle icon */
        color: #721c24;
    }

    .alert-info {
        background-color: rgba(25, 39, 82, 0.9); /* var(--primary-bg) with opacity */
        color: #F8CE9F; /* var(--secondary-bg) */
        border-left: 4px solid #F8CE9F;
    }

    .alert-info:before {
        content: "\f05a"; /* info-circle icon */
        color: #F8CE9F;
    }

    /* Close Button */
    .alert .close {
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: inherit;
        opacity: 0.8;
        padding: 0;
        background: none;
        border: none;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .alert {
            margin: 1rem 15px;
            padding: 1rem 1rem 1rem 2.5rem;
            font-size: 0.9rem;
        }

        .alert:before {
            font-size: 1.2rem;
            left: 0.8rem;
        }

        .alert .close {
            right: 0.5rem;
            font-size: 1.5rem;
        }
    }

    @media (max-width: 576px) {
        .alert {
            border-radius: 6px;
            padding: 0.8rem 0.8rem 0.8rem 2.2rem;
            margin: 0.5rem 10px;
        }

        .alert:before {
            font-size: 1rem;
            left: 0.6rem;
        }
    }

    /* Animation */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .alert {
        animation: slideIn 0.3s ease-out;
    }
</style>
    <style>
/* Certifications Grid */
.certification-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
}

.certification-option input[type="checkbox"] {
    display: none;
}

.cert-label {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    background: rgba(248, 206, 159, 0.15);
    border: 2px solid #F8CE9F;
    border-radius: 0.5rem;
    color: #F8CE9F;
    cursor: pointer;
    transition: all 0.3s ease;
}

.cert-label:hover {
    background: rgba(114, 59, 24, 0.3);
}

.certification-option input:checked + .cert-label {
    background: #F8CE9F;
    color: #192752;
    border-color: #F8CE9F;
    font-weight: 600;
}
#certificationsDropdownBtn {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: left;
}

.dropdown-menu li {
    padding: 0.25rem 0.5rem;
}

.dropdown-menu li label {
    cursor: pointer;
    width: 100%;
}
@media (max-width: 768px) {
    .certification-grid {
        grid-template-columns: 1fr;
    }
}
</style>
<div class="edit-profile-container">
    <div class="profile-card shadow-lg">
        <div class="card-body">
            <div class="text-center mb-4">
                <h2 class="fw-bold mb-3">Edit Your Profile</h2>
                <p class="opacity-75">Update your account details or change your password</p>
            </div>

<!-- Message Display Section -->
<div class="message-container" aria-live="polite" aria-atomic="true">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message|safe }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endfor %}
</div>

            <!-- Profile Update Form -->
<form method="post" novalidate>
    {% csrf_token %}
    <h4 class="text-center fw-bold mb-4">Profile Information</h4>

                <!-- Username and Email -->
                <div class="mb-3">
                    <label class="form-label">{{ user_form.username.label }}</label>
                    {{ user_form.username|add_class:"form-control shadow-sm" }}
                    {% if user_form.username.errors %}
                        <div class="invalid-feedback">
                            {{ user_form.username.errors.as_text }}
                        </div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control"
                        value="{{ user.email }}" disabled>
                </div>

                <!-- Role Display -->
                <div class="mb-3">
                    <label class="form-label">Account Type</label>
                    <input type="text" class="form-control"
                           value="{{ profile_form.instance.get_role_display }}"
                           disabled>
                </div>
                <!-- Contact -->
                <div class="mb-3">
                    <label class="form-label">Contact </label>
                    {{ profile_form.contact_no|add_class:"form-control" }}
                    {% if profile_form.contact_no.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in profile_form.contact_no.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>
                <!-- Business Information -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">{{ profile_form.business_type.label }}</label>
                            {{ profile_form.business_type|add_class:"form-control shadow-sm" }}
                        </div>
                        <div class="mb-3">
                            <label class="form-label">{{ profile_form.operation_type.label }}</label>
                            <div class="select-wrapper">
                                {{ profile_form.operation_type|add_class:"form-control shadow-sm custom-select" }}
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">{{ profile_form.leather_types.label }}</label>
                            <div class="input-group">
                                <div class="dropdown" style="width: 100%;">
                                    <button class="btn btn-outline-secondary form-control text-start dropdown-toggle" style="color: #F8CE9F;" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Select Leather Types
                                    </button>
                                    <ul class="dropdown-menu w-100 px-3" style="max-height: 250px; overflow-y: auto;" id="leatherTypesDropdown">
                                    <li class="mb-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary w-100" id="toggleLeatherSelectAll">✔ Select All</button>
                                    </li>
                                    <!-- <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="All ✓" name="leather_types">All ✓</label></li> -->
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Full grain" name="leather_types"><span class="label-text">Full grain</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Lining" name="leather_types"><span class="label-text">Lining</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Patent" name="leather_types"><span class="label-text">Patent</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Printed" name="leather_types"><span class="label-text">Printed</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="PU coated" name="leather_types"><span class="label-text">PU coated</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Skins" name="leather_types"><span class="label-text">Skins</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Sole" name="leather_types"><span class="label-text">Sole</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Split" name="leather_types"><span class="label-text">Split</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Suede" name="leather_types"><span class="label-text">Suede</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Top Grain Split" name="leather_types"><span class="label-text">Top Grain Split</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Wool-on" name="leather_types"><span class="label-text">Wool-on</span></label></li>
                                    <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Flesh/Drop Splits" name="leather_types"><span class="label-text">Flesh/Drop Splits</span></label></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                            const toggleLeatherBtn = document.getElementById('toggleLeatherSelectAll');
                            const leatherCheckboxes = document.querySelectorAll('input[name="leather_types"]');

                            toggleLeatherBtn.addEventListener('click', function () {
                                const allChecked = Array.from(leatherCheckboxes).every(cb => cb.checked);
                                leatherCheckboxes.forEach(cb => cb.checked = !allChecked);
                                toggleLeatherBtn.textContent = allChecked ? '✔ Select All' : '✖ Deselect All';
                            });
                            });
                        </script>
                        <div class="mb-3">
                            <label class="form-label">{{ profile_form.animal_types.label }}</label>
                            <div class="input-group">
                                <div class="dropdown" style="width: 100%;">
                                    <button class="btn btn-outline-secondary form-control text-start dropdown-toggle" style="color: #F8CE9F;" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        Select Animal Types
                                    </button>
                                    <ul class="dropdown-menu w-100 px-3" style="max-height: 250px; overflow-y: auto;" id="animalTypesDropdown">
                                        <li class="mb-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary w-100" id="toggleSelectAll">✔ Select All</button>
                                        </li>
                                        <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Cow" name="animal_types"><span class="label-text">Cow</span></label></li>
                                        <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Buffalo" name="animal_types"><span class="label-text">Buffalo</span></label></li>
                                        <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Sheep" name="animal_types"><span class="label-text">Sheep</span></label></li>
                                        <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Goat" name="animal_types"><span class="label-text">Goat</span></label></li>
                                        <li><label class="form-check d-flex align-items-center"><input class="form-check-input me-2 big-checkbox" type="checkbox" value="Camel" name="animal_types"><span class="label-text">Camel</span></label></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <style>
                            .big-checkbox {
                              width: 1.5em;
                              height: 1.5em;
                            }

                            .label-text {
                                padding-left: 8px; /* adjust as needed */
                                padding-top: 5px;
                            }

                        </style>

                        <!-- Bootstrap JS -->
                        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

                        <!-- JavaScript for Select All / Deselect All -->
                        <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const toggleBtn = document.getElementById('toggleSelectAll');
                            const checkboxes = document.querySelectorAll('input[name="animal_types"]');

                            toggleBtn.addEventListener('click', function () {
                            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                            checkboxes.forEach(cb => cb.checked = !allChecked);
                            toggleBtn.textContent = allChecked ? '✔ Select All' : '✖ Deselect All';
                            });
                        });
                        </script>
                    </div>
                </div>

                <!-- Location Information -->
<div class="row g-3">
    <div class="col-md-6">
        <div class="mb-3">
            <label class="form-label">City <span class="required-asterisk">*</span></label>
            <div class="select-wrapper">
                {{ profile_form.city|add_class:"form-control shadow-sm custom-select" }}
                <i class="fas fa-chevron-down dropdown-arrow"></i>
            </div>
            <div class="mt-2" id="custom-city-container"
                 style="{% if profile_form.city.value == 'Other' %}display: block;{% else %}display: none;{% endif %}">
                {{ profile_form.custom_city|add_class:"form-control shadow-sm" }}
                {% if profile_form.custom_city.errors %}
                    <div class="invalid-feedback">
                        {{ profile_form.custom_city.errors.as_text }}
                    </div>
                {% endif %}
            </div>
            {% if profile_form.city.errors %}
                <div class="invalid-feedback">
                    {{ profile_form.city.errors.as_text }}
                </div>
            {% endif %}
        </div>
    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">{{ profile_form.location.label }}</label>
                            {{ profile_form.location|add_class:"form-control shadow-sm" }}
                        </div>
                    </div>
                </div>

{% if profile_form.brand|is_select %}
<div class="mb-3" id="brand_field">
    <label class="form-label">Brand <span class="required-asterisk">*</span></label>
    <div class="select-wrapper">
        {{ profile_form.brand|add_class:"form-control shadow-sm custom-select" }}
        <i class="fas fa-chevron-down dropdown-arrow"></i>
    </div>

    <div class="mt-2" id="custom_brand_container"
         style="{% if profile_form.brand.value == 'Other' %}display: block;{% else %}display: none;{% endif %}">
        {{ profile_form.custom_brand|add_class:"form-control shadow-sm" }}
        {% if profile_form.custom_brand.errors %}
            <div class="invalid-feedback d-block">
                {{ profile_form.custom_brand.errors.as_text }}
            </div>
        {% endif %}
    </div>
</div>
{% else %}
<div class="mb-3">
    <label class="form-label">Brand</label>
    {{ profile_form.brand|add_class:"form-control shadow-sm" }}
</div>
{% endif %}


                <!-- Certifications -->
                <div class="mb-4">
                    <label class="form-label">Certifications <small class="text-muted">(Click to select multiple)</small></label>
                    <div class="input-group">
                        <div class="dropdown" style="width: 86%;">
                            <button class="btn btn-outline-secondary form-control text-start dropdown-toggle"
                                    style="color: #F8CE9F;"
                                    type="button"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false"
                                    id="certificationsDropdownBtn">
                                {% if profile_form.certifications.value %}
                                    {{ profile_form.certifications.value|join:", " }}
                                {% else %}
                                    Select Certifications
                                {% endif %}
                            </button>
                            <ul class="dropdown-menu w-100 px-3" style="max-height: 250px; overflow-y: auto;">
                                <li class="mb-2">
                                    <button type="button" class="btn btn-sm btn-outline-primary w-100"
                                            id="toggleCertSelectAll">
                                        ✔ Select All
                                    </button>
                                </li>
                                {% for value, text in profile_form.certifications.field.choices %}
                                <li>
                                    <label class="form-check d-flex align-items-center">
                                        <input class="form-check-input me-2 big-checkbox"
                                               type="checkbox"
                                               value="{{ value }}"
                                               name="certifications"
                                               {% if value in profile_form.certifications.value %}checked{% endif %}>
                                        <span class="label-text">{{ text }}</span>
                                    </label>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div id="customCertInput" class="mt-2"
                         style="{% if 'Other' in profile_form.certifications.value %}display: block;{% else %}display: none;{% endif %}">
                        {{ profile_form.custom_certification|add_class:"form-control shadow-sm" }}
                        {% if profile_form.custom_certification.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in profile_form.custom_certification.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    {% if profile_form.certifications.errors %}
                        <div class="invalid-feedback">
                            {{ profile_form.certifications.errors.as_text }}
                        </div>
                    {% endif %}
                </div>

    <div class="text-center">
        <button type="submit" name="profile_submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Save Profile
        </button>
    </div>
</form>

            <hr class="my-4">

<!-- Password Change Form -->
<form method="post" novalidate>
    {% csrf_token %}
    <h4 class="text-center fw-bold mb-4">Change Password</h4>

                <div class="mb-3">
                    <label class="form-label">{{ password_form.old_password.label }}</label>
                    {{ password_form.old_password|add_class:"form-control shadow-sm" }}
                    {% if password_form.old_password.errors %}
                        <div class="invalid-feedback">
                            {{ password_form.old_password.errors.as_text }}
                        </div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ password_form.new_password1.label }}</label>
                    {{ password_form.new_password1|add_class:"form-control shadow-sm" }}
                    {% if password_form.new_password1.errors %}
                        <div class="invalid-feedback">
                            {{ password_form.new_password1.errors.as_text }}
                        </div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label class="form-label">{{ password_form.new_password2.label }}</label>
                    {{ password_form.new_password2|add_class:"form-control shadow-sm" }}
                    {% if password_form.new_password2.errors %}
                        <div class="invalid-feedback">
                            {{ password_form.new_password2.errors.as_text }}
                        </div>
                    {% endif %}
                </div>

                <ul id="password-requirements" class="small mt-2 ps-3">
                    <li id="req-length">At least 8 characters</li>
                    <li id="req-uppercase">At least 1 uppercase letter</li>
                    <li id="req-lowercase">At least 1 lowercase letter</li>
                    <li id="req-number">At least 1 number</li>
                    <li id="req-special">At least 1 special character (!@#$%^&*)</li>
                </ul>

    <div class="text-center">
        <button type="submit" name="password_submit" class="btn btn-primary">
            <i class="fas fa-key me-2"></i>Change Password
        </button>
    </div>
</form>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // City Field Handling
    const citySelect = document.querySelector("select[name='city']");
    const customCityContainer = document.getElementById("custom-city-container");

    if (citySelect) {
        function updateCityDisplay() {
            customCityContainer.style.display =
                citySelect.value === 'Other' ? 'block' : 'none';
        }
        citySelect.addEventListener('change', updateCityDisplay);
        updateCityDisplay();
    }

    // Brand Field Handling - Corrected
    const brandSelect = document.querySelector("select[name='brand']");
    const customBrandContainer = document.getElementById("custom_brand_container");

    if (brandSelect) {
        function updateBrandDisplay() {
            customBrandContainer.style.display =
                brandSelect.value === 'Other' ? 'block' : 'none';
        }

        // Initialize display
        updateBrandDisplay();

        // Add event listener
        brandSelect.addEventListener('change', updateBrandDisplay);
    }

    // Password Validation Feedback
    const passwordInput = document.querySelector("input[name='new_password1']");
    const requirements = {
        length: document.getElementById('req-length'),
        uppercase: document.getElementById('req-uppercase'),
        lowercase: document.getElementById('req-lowercase'),
        number: document.getElementById('req-number'),
        special: document.getElementById('req-special')
    };

    if (passwordInput) {
        passwordInput.addEventListener('input', function(e) {
            const value = e.target.value;
            requirements.length.style.color = value.length >= 8 ? '#F8CE9F' : '#ff6b6b';
            requirements.uppercase.style.color = /[A-Z]/.test(value) ? '#F8CE9F' : '#ff6b6b';
            requirements.lowercase.style.color = /[a-z]/.test(value) ? '#F8CE9F' : '#ff6b6b';
            requirements.number.style.color = /\d/.test(value) ? '#F8CE9F' : '#ff6b6b';
            requirements.special.style.color = /[!@#$%^&*]/.test(value) ? '#F8CE9F' : '#ff6b6b';
        });

        passwordInput.addEventListener('blur', function() {
            if (this.value.length > 0) {
                document.getElementById('password-requirements').style.opacity = '1';
            } else {
                document.getElementById('password-requirements').style.opacity = '0.6';
            }
        });
    }

    // Initialize select colors
    document.querySelectorAll('.custom-select').forEach(select => {
        select.style.color = select.value ? 'var(--text-light)' : 'rgba(248, 206, 159, 0.5)';
        select.addEventListener('change', function() {
            this.style.color = this.value ? 'var(--text-light)' : 'rgba(248, 206, 159, 0.5)';
        });
    });
});
</script>
    <script>
document.addEventListener("DOMContentLoaded", function() {
    // Auto-logout after password change
    {% if messages %}
        {% for message in messages %}
            {% if 'Password changed successfully' in message.message %}
                setTimeout(() => {
                    const logoutForm = document.createElement('form');
                    logoutForm.method = 'POST';
                    logoutForm.action = "{% url 'logout' %}";

                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrfmiddlewaretoken';
                    csrfInput.value = '{{ csrf_token }}';

                    logoutForm.appendChild(csrfInput);
                    document.body.appendChild(logoutForm);
                    logoutForm.submit();
                }, 2000);
            {% endif %}
        {% endfor %}
    {% endif %}
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Certifications handling
    const certCheckboxes = document.querySelectorAll('input[name="certifications"]');
    const customCertInput = document.getElementById('customCertInput');
    const certDropdownBtn = document.getElementById('certificationsDropdownBtn');
    const certToggleBtn = document.getElementById('toggleCertSelectAll');

    // Toggle Select All functionality
    certToggleBtn.addEventListener('click', function() {
        const allChecked = Array.from(certCheckboxes).every(cb => cb.checked);
        certCheckboxes.forEach(cb => cb.checked = !allChecked);
        this.textContent = allChecked ? '✔ Select All' : '✖ Deselect All';
        updateCertButtonText();
        updateCustomCertVisibility();
    });

    // Update dropdown button text
    function updateCertButtonText() {
        const selected = Array.from(certCheckboxes)
            .filter(cb => cb.checked)
            .map(cb => {
                if (cb.value === 'Other') {
                    return document.querySelector('input[name="custom_certification"]').value || 'Other';
                }
                return cb.nextElementSibling.textContent.trim();
            });

        certDropdownBtn.textContent = selected.length > 0 ?
            selected.join(', ') :
            'Select Certifications';
    }

    // Handle custom certification visibility
    function updateCustomCertVisibility() {
        const otherChecked = Array.from(certCheckboxes).find(cb => cb.value === 'Other' && cb.checked);
        customCertInput.style.display = otherChecked ? 'block' : 'none';
    }

    // Individual checkbox handlers
    certCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateCertButtonText();
            updateCustomCertVisibility();
        });
    });

    // Custom certification input handler
    document.querySelector('input[name="custom_certification"]')?.addEventListener('input', function() {
        updateCertButtonText();
    });

    // Initialize view
    function initializeCertifications() {
        updateCertButtonText();
        updateCustomCertVisibility();

        // Set initial toggle button state
        const allChecked = certCheckboxes.length > 0 &&
            Array.from(certCheckboxes).every(cb => cb.checked);
        certToggleBtn.textContent = allChecked ? '✖ Deselect All' : '✔ Select All';
    }

    // Mobile view adjustments
    function adjustMobileView() {
        if (window.innerWidth <= 768) {
            document.querySelectorAll('.form-control').forEach(input => {
                input.style.borderWidth = '2px';
            });
            certDropdownBtn.style.fontSize = '14px';
        } else {
            certDropdownBtn.style.fontSize = '';
        }
    }

    // Initial setup
    initializeCertifications();
    adjustMobileView();

    // Event listeners
    window.addEventListener('resize', adjustMobileView);
});
</script>
{% endblock %}
